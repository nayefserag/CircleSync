{"version":3,"file":"module.js","sources":["../../src/module.ts"],"sourcesContent":["import { posix, sep } from 'path';\n\nconst isWindowsPlatform = sep === '\\\\';\n\n/** normalizes Windows paths */\nfunction normalizeWindowsPath(path: string): string {\n  return path\n    .replace(/^[A-Z]:/, '') // remove Windows-style prefix\n    .replace(/\\\\/g, '/'); // replace all `\\` instances with `/`\n}\n\n/** Gets the module from a filename */\nexport function getModuleFromFilename(\n  filename: string | undefined,\n  normalizeWindowsPathSeparator: boolean = isWindowsPlatform,\n): string | undefined {\n  if (!filename) {\n    return;\n  }\n\n  const normalizedFilename = normalizeWindowsPathSeparator ? normalizeWindowsPath(filename) : filename;\n\n  // eslint-disable-next-line prefer-const\n  let { root, dir, base: basename, ext } = posix.parse(normalizedFilename);\n\n  const base = (require && require.main && require.main.filename && dir) || global.process.cwd();\n\n  const normalizedBase = `${base}/`;\n\n  // It's specifically a module\n  let file = basename;\n\n  if (ext === '.js') {\n    file = file.slice(0, file.length - '.js'.length);\n  }\n\n  if (!root && !dir) {\n    // No dirname whatsoever\n    dir = '.';\n  }\n\n  let n = dir.lastIndexOf('/node_modules/');\n  if (n > -1) {\n    // /node_modules/ is 14 chars\n    return `${dir.slice(n + 14).replace(/\\//g, '.')}:${file}`;\n  }\n  // Let's see if it's a part of the main module\n  // To be a part of main module, it has to share the same base\n  n = `${dir}/`.lastIndexOf(normalizedBase, 0);\n\n  if (n === 0) {\n    let moduleName = dir.slice(normalizedBase.length).replace(/\\//g, '.');\n    if (moduleName) {\n      moduleName += ':';\n    }\n    moduleName += file;\n    return moduleName;\n  }\n  return file;\n}\n"],"names":["sep","posix"],"mappings":";;;;AAEA,MAAA,iBAAA,GAAAA,QAAA,KAAA,IAAA,CAAA;AACA;AACA;AACA,SAAA,oBAAA,CAAA,IAAA,EAAA;AACA,EAAA,OAAA,IAAA;AACA,KAAA,OAAA,CAAA,SAAA,EAAA,EAAA,CAAA;AACA,KAAA,OAAA,CAAA,KAAA,EAAA,GAAA,CAAA,CAAA;AACA,CAAA;AACA;AACA;AACA,SAAA,qBAAA;AACA,EAAA,QAAA;AACA,EAAA,6BAAA,GAAA,iBAAA;AACA,EAAA;AACA,EAAA,IAAA,CAAA,QAAA,EAAA;AACA,IAAA,OAAA;AACA,GAAA;AACA;AACA,EAAA,MAAA,kBAAA,GAAA,6BAAA,GAAA,oBAAA,CAAA,QAAA,CAAA,GAAA,QAAA,CAAA;AACA;AACA;AACA,EAAA,IAAA,EAAA,IAAA,EAAA,GAAA,EAAA,IAAA,EAAA,QAAA,EAAA,GAAA,EAAA,GAAAC,UAAA,CAAA,KAAA,CAAA,kBAAA,CAAA,CAAA;AACA;AACA,EAAA,MAAA,IAAA,GAAA,CAAA,OAAA,IAAA,OAAA,CAAA,IAAA,IAAA,OAAA,CAAA,IAAA,CAAA,QAAA,IAAA,GAAA,KAAA,MAAA,CAAA,OAAA,CAAA,GAAA,EAAA,CAAA;AACA;AACA,EAAA,MAAA,cAAA,GAAA,CAAA,EAAA,IAAA,CAAA,CAAA,CAAA,CAAA;AACA;AACA;AACA,EAAA,IAAA,IAAA,GAAA,QAAA,CAAA;AACA;AACA,EAAA,IAAA,GAAA,KAAA,KAAA,EAAA;AACA,IAAA,IAAA,GAAA,IAAA,CAAA,KAAA,CAAA,CAAA,EAAA,IAAA,CAAA,MAAA,GAAA,KAAA,CAAA,MAAA,CAAA,CAAA;AACA,GAAA;AACA;AACA,EAAA,IAAA,CAAA,IAAA,IAAA,CAAA,GAAA,EAAA;AACA;AACA,IAAA,GAAA,GAAA,GAAA,CAAA;AACA,GAAA;AACA;AACA,EAAA,IAAA,CAAA,GAAA,GAAA,CAAA,WAAA,CAAA,gBAAA,CAAA,CAAA;AACA,EAAA,IAAA,CAAA,GAAA,CAAA,CAAA,EAAA;AACA;AACA,IAAA,OAAA,CAAA,EAAA,GAAA,CAAA,KAAA,CAAA,CAAA,GAAA,EAAA,CAAA,CAAA,OAAA,CAAA,KAAA,EAAA,GAAA,CAAA,CAAA,CAAA,EAAA,IAAA,CAAA,CAAA,CAAA;AACA,GAAA;AACA;AACA;AACA,EAAA,CAAA,GAAA,CAAA,EAAA,GAAA,CAAA,CAAA,CAAA,CAAA,WAAA,CAAA,cAAA,EAAA,CAAA,CAAA,CAAA;AACA;AACA,EAAA,IAAA,CAAA,KAAA,CAAA,EAAA;AACA,IAAA,IAAA,UAAA,GAAA,GAAA,CAAA,KAAA,CAAA,cAAA,CAAA,MAAA,CAAA,CAAA,OAAA,CAAA,KAAA,EAAA,GAAA,CAAA,CAAA;AACA,IAAA,IAAA,UAAA,EAAA;AACA,MAAA,UAAA,IAAA,GAAA,CAAA;AACA,KAAA;AACA,IAAA,UAAA,IAAA,IAAA,CAAA;AACA,IAAA,OAAA,UAAA,CAAA;AACA,GAAA;AACA,EAAA,OAAA,IAAA,CAAA;AACA;;;;"}