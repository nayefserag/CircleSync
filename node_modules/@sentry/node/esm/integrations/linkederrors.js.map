{"version":3,"file":"linkederrors.js","sources":["../../../src/integrations/linkederrors.ts"],"sourcesContent":["import type { Event, EventHint, EventProcessor, Hub, Integration } from '@sentry/types';\nimport { applyAggregateErrorsToEvent } from '@sentry/utils';\n\nimport { exceptionFromError } from '../eventbuilder';\nimport { ContextLines } from './contextlines';\n\nconst DEFAULT_KEY = 'cause';\nconst DEFAULT_LIMIT = 5;\n\n/** Adds SDK info to an event. */\nexport class LinkedErrors implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'LinkedErrors';\n\n  /**\n   * @inheritDoc\n   */\n  public readonly name: string = LinkedErrors.id;\n\n  /**\n   * @inheritDoc\n   */\n  private readonly _key: string;\n\n  /**\n   * @inheritDoc\n   */\n  private readonly _limit: number;\n\n  /**\n   * @inheritDoc\n   */\n  public constructor(options: { key?: string; limit?: number } = {}) {\n    this._key = options.key || DEFAULT_KEY;\n    this._limit = options.limit || DEFAULT_LIMIT;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(addGlobalEventProcessor: (callback: EventProcessor) => void, getCurrentHub: () => Hub): void {\n    addGlobalEventProcessor(async (event: Event, hint?: EventHint) => {\n      const hub = getCurrentHub();\n      const client = hub.getClient();\n      const self = hub.getIntegration(LinkedErrors);\n\n      if (!client || !self) {\n        return event;\n      }\n\n      const options = client.getOptions();\n\n      applyAggregateErrorsToEvent(\n        exceptionFromError,\n        options.stackParser,\n        options.maxValueLength,\n        self._key,\n        self._limit,\n        event,\n        hint,\n      );\n\n      // If the ContextLines integration is enabled, we add source code context to linked errors\n      // because we can't guarantee the order that integrations are run.\n      const contextLines = getCurrentHub().getIntegration(ContextLines);\n      if (contextLines) {\n        await contextLines.addSourceContext(event);\n      }\n\n      return event;\n    });\n  }\n}\n"],"names":[],"mappings":";;;;AAMA,MAAA,WAAA,GAAA,OAAA,CAAA;AACA,MAAA,aAAA,GAAA,CAAA,CAAA;AACA;AACA;AACA,MAAA,YAAA,EAAA;AACA;AACA;AACA;AACA,GAAA,OAAA,YAAA,GAAA,CAAA,IAAA,CAAA,EAAA,GAAA,eAAA,CAAA;AACA;AACA;AACA;AACA;AACA,IAAA,MAAA,GAAA,CAAA,IAAA,CAAA,IAAA,GAAA,YAAA,CAAA,GAAA,CAAA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;;AAGA;AACA;AACA;AACA,GAAA,WAAA,CAAA,OAAA,GAAA,EAAA,EAAA,CAAA,YAAA,CAAA,SAAA,CAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACA,IAAA,IAAA,CAAA,IAAA,GAAA,OAAA,CAAA,GAAA,IAAA,WAAA,CAAA;AACA,IAAA,IAAA,CAAA,MAAA,GAAA,OAAA,CAAA,KAAA,IAAA,aAAA,CAAA;AACA,GAAA;AACA;AACA;AACA;AACA;AACA,GAAA,SAAA,CAAA,uBAAA,EAAA,aAAA,EAAA;AACA,IAAA,uBAAA,CAAA,OAAA,KAAA,EAAA,IAAA,KAAA;AACA,MAAA,MAAA,GAAA,GAAA,aAAA,EAAA,CAAA;AACA,MAAA,MAAA,MAAA,GAAA,GAAA,CAAA,SAAA,EAAA,CAAA;AACA,MAAA,MAAA,IAAA,GAAA,GAAA,CAAA,cAAA,CAAA,YAAA,CAAA,CAAA;AACA;AACA,MAAA,IAAA,CAAA,MAAA,IAAA,CAAA,IAAA,EAAA;AACA,QAAA,OAAA,KAAA,CAAA;AACA,OAAA;AACA;AACA,MAAA,MAAA,OAAA,GAAA,MAAA,CAAA,UAAA,EAAA,CAAA;AACA;AACA,MAAA,2BAAA;AACA,QAAA,kBAAA;AACA,QAAA,OAAA,CAAA,WAAA;AACA,QAAA,OAAA,CAAA,cAAA;AACA,QAAA,IAAA,CAAA,IAAA;AACA,QAAA,IAAA,CAAA,MAAA;AACA,QAAA,KAAA;AACA,QAAA,IAAA;AACA,OAAA,CAAA;AACA;AACA;AACA;AACA,MAAA,MAAA,YAAA,GAAA,aAAA,EAAA,CAAA,cAAA,CAAA,YAAA,CAAA,CAAA;AACA,MAAA,IAAA,YAAA,EAAA;AACA,QAAA,MAAA,YAAA,CAAA,gBAAA,CAAA,KAAA,CAAA,CAAA;AACA,OAAA;AACA;AACA,MAAA,OAAA,KAAA,CAAA;AACA,KAAA,CAAA,CAAA;AACA,GAAA;AACA,CAAA,CAAA,YAAA,CAAA,YAAA,EAAA;;;;"}